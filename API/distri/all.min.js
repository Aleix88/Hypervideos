"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&_setPrototypeOf(r,n.prototype),r}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Observer=function(){function e(t){_classCallCheck(this,e),this.onChange=t}return _createClass(e,[{key:"update",value:function(e){this.onChange(e)}}]),e}(),Subject=function(){function e(){_classCallCheck(this,e),this.observers=[]}return _createClass(e,[{key:"addObserver",value:function(e){this.observers.push(e)}},{key:"removeObserver",value:function(e){var t=this.observers.findIndex(function(t){return e===t});-1!==t&&(this.observers=this.observers.slice(t,1))}},{key:"notify",value:function(e){this.observers.forEach(function(t){return t.update(e)})}}]),e}(),ContainerManager=function(e){_inherits(n,Subject);var t=_createSuper(n);function n(e){var i;return _classCallCheck(this,n),(i=t.call(this)).containerID=e,i.videoStateChanged=null,i.isFullScreen=!1,i.__exitFullScreenEventListeners(),i}return _createClass(n,[{key:"play",value:function(){}},{key:"pause",value:function(){}},{key:"restartVideo",value:function(){}},{key:"isVideoPlaying",value:function(){}},{key:"loadProgress",value:function(e){}},{key:"setVolume",value:function(e){}},{key:"__exitFullScreenEventListeners",value:function(){document.addEventListener("fullscreenchange",this._exitFSHandler.bind(this),!1),document.addEventListener("mozfullscreenchange",this._exitFSHandler.bind(this),!1),document.addEventListener("MSFullscreenChange",this._exitFSHandler.bind(this),!1),document.addEventListener("webkitfullscreenchange",this._exitFSHandler.bind(this),!1)}},{key:"_exitFSHandler",value:function(e){document.fullscreenElement||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||(this.isFullScreen=!1,this.videoStateChanged(n.EXIT_FULL_SCREEN))}},{key:"_enterFSHandler",value:function(){this.isFullScreen=!0,this.videoStateChanged(n.ENTER_FULL_SCREEN)}},{key:"toggleFullScreen",value:function(){var e=document.getElementById(this.containerID);this.isFullScreen?this.requestExitFullScreen(e):this.requestFullScreen(e)}},{key:"requestFullScreen",value:function(e){e.requestFullscreen?(e.requestFullscreen(),this._enterFSHandler()):e.mozRequestFullScreen?(e.mozRequestFullScreen(),this._enterFSHandler()):e.webkitRequestFullscreen?(e.webkitRequestFullscreen(),this._enterFSHandler()):e.msRequestFullscreen&&(e.msRequestFullscreen(),this._enterFSHandler())}},{key:"requestExitFullScreen",value:function(e){document.exitFullscreen?(document.exitFullscreen(),this._exitFSHandler()):document.mozCancelFullScreen?(document.mozCancelFullScreen(),this._exitFSHandler()):document.webkitExitFullscreen&&(document.webkitExitFullscreen(),this._exitFSHandler())}},{key:"currentTime",get:function(){return 0}}]),n}();_defineProperty(ContainerManager,"PLAYING",0),_defineProperty(ContainerManager,"PAUSED",1),_defineProperty(ContainerManager,"LOADED",2),_defineProperty(ContainerManager,"ENTER_FULL_SCREEN",3),_defineProperty(ContainerManager,"EXIT_FULL_SCREEN",4);var VideoManagerFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"create",value:function(e,t){switch(e){case Hypervideo.YOUTUBE_TYPE:return new YoutubeVideoManager(t);default:return new VideoTagManager(t)}}}]),e}(),VideoTagManager=function(e){_inherits(n,ContainerManager);var t=_createSuper(n);function n(e){var i;return _classCallCheck(this,n),(i=t.call(this,e)).videoTimer=new VideoTimer(i.__timeHandler.bind(_assertThisInitialized(i))),i}return _createClass(n,[{key:"play",value:function(){document.getElementById(this.containerID).querySelector("video").play()}},{key:"pause",value:function(){document.getElementById(this.containerID).querySelector("video").pause()}},{key:"restartVideo",value:function(){this.loadProgress(0)}},{key:"isVideoPlaying",value:function(){return!document.getElementById(this.containerID).querySelector("video").paused}},{key:"loadProgress",value:function(e){var t=document.getElementById(this.containerID).querySelector("video");t.currentTime=t.duration*e,this.videoTimer.loadOffset(t.currentTime-Math.floor(t.currentTime)),this.notify(t.currentTime)}},{key:"setupVideo",value:function(){var e=document.getElementById(this.containerID).querySelector("video");e.addEventListener("pause",this.__videoIsPaused.bind(this)),e.addEventListener("play",this.__videoIsPlaying.bind(this)),e.addEventListener("loadeddata",this.__videoLoaded.bind(this))}},{key:"__videoIsPlaying",value:function(){this.videoStateChanged(ContainerManager.PLAYING),this.videoTimer.play()}},{key:"__videoIsPaused",value:function(){this.videoStateChanged(ContainerManager.PAUSED),this.videoTimer.pause()}},{key:"__videoLoaded",value:function(){var e=document.getElementById(this.containerID).querySelector("video");this.videoStateChanged(ContainerManager.LOADED,{duration:e.duration})}},{key:"__timeHandler",value:function(){var e=document.getElementById(this.containerID).querySelector("video");this.notify(e.currentTime)}},{key:"setVolume",value:function(e){e=(e=e>1?1:e)<0?0:e,this.htmlManager.getShadowElementByID(this.containerID,this.videoElementID).volume=e}},{key:"setVolume",value:function(e){e=(e=e>1?1:e)<0?0:e,document.getElementById(this.containerID).querySelector("video").volume=e}},{key:"currentTime",get:function(){return document.getElementById(this.containerID).querySelector("video").currentTime}}]),n}(),YoutubeVideoManager=function(e){_inherits(n,ContainerManager);var t=_createSuper(n);function n(e){var i;return _classCallCheck(this,n),(i=t.call(this,e)).player=null,i.firstTimePlaying=!0,i.videoTimer=new VideoTimer(i.__timeHandler.bind(_assertThisInitialized(i))),i}return _createClass(n,[{key:"play",value:function(){null!==this.player&&this.player.playVideo()}},{key:"pause",value:function(){null!==this.player&&this.player.pauseVideo()}},{key:"restartVideo",value:function(){this.__loadTime(0)}},{key:"isVideoPlaying",value:function(){return this.player.getPlayerState()==YT.PlayerState.PLAYING}},{key:"loadProgress",value:function(e){var t=this.player.getDuration();this.__loadTime(t*e)}},{key:"__loadTime",value:function(e){if(null!==this.player){this.player.seekTo(e,!0);var t=this.player.getCurrentTime();this.videoTimer.loadOffset(t-Math.floor(t)),this.notify(e)}}},{key:"setVolume",value:function(e){null!==this.player&&(e=(e=e>1?1:e)<0?0:e,this.player.setVolume(100*e))}},{key:"addYoutubeScript",value:function(e,t){this.iframeContainerID=e,this.videoID=t;var n=document.createElement("script");n.src="https://www.youtube.com/iframe_api",document.getElementsByTagName("script")[0].appendChild(n),window.onYouTubeIframeAPIReady=this.__onYouTubeIframeAPIReady.bind(this)}},{key:"__onYouTubeIframeAPIReady",value:function(){var e=new YT.Player(this.iframeContainerID,{height:"360",width:"640",videoId:this.videoID,events:{onReady:this.__onPlayerReady.bind(this),onStateChange:this.__onPlayerStateChange.bind(this)},playerVars:{autoplay:0,controls:0,disablekb:1,fs:0,modestbranding:1,rel:0,iv_load_policy:3,autohide:1,wmode:"opaque",start:0}});this.player=e}},{key:"__onPlayerReady",value:function(e){document.querySelector("#"+this.iframeContainerID).style.pointerEvents="none",this.videoStateChanged(ContainerManager.LOADED,{duration:this.player.getDuration()})}},{key:"__onPlayerStateChange",value:function(e){e.data==YT.PlayerState.PLAYING?(console.log(),!0===this.firstTimePlaying&&this.player.getCurrentTime()>=.1&&this.__loadTime(0),this.videoStateChanged(ContainerManager.PLAYING),this.videoTimer.play(),this.firstTimePlaying=!1):e.data==YT.PlayerState.PAUSED&&(this.videoStateChanged(ContainerManager.PAUSED),this.videoTimer.pause())}},{key:"__timeHandler",value:function(){this.notify(this.player.getCurrentTime())}},{key:"currentTime",get:function(){return this.player.getCurrentTime()}}]),n}(),HTMLManager=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"createElement",value:function(e,t,n){var i=document.createElement(e);return Array.isArray(t)&&t.length>0&&t.forEach(function(e){i.classList.add(e)}),null!=n&&(i.id=n),i}},{key:"getShadowElementByID",value:function(e,t){return document.getElementById(e).shadowRoot.getElementById(t)}},{key:"getShadowElementByClassName",value:function(e,t){return document.getElementById(e).shadowRoot.querySelector("."+t)}},{key:"hexToRGBA",value:function(e,t){return"rgba("+parseInt(e.slice(1,3),16)+", "+parseInt(e.slice(3,5),16)+", "+parseInt(e.slice(5,7),16)+", "+t+")"}}]),e}(),VideoTimer=function(){function e(t){_classCallCheck(this,e),this.loopCounter=0,this.timeHandler=t,this.timer=null,this.isPlaying=!1}return _createClass(e,[{key:"play",value:function(){!0!==this.isPlaying&&(this.timer=setInterval(this.__handleTime.bind(this),e.LOOP_TIME),this.isPlaying=!0)}},{key:"pause",value:function(){clearInterval(this.timer),this.isPlaying=!1}},{key:"loadOffset",value:function(t){this.loopCounter=parseInt(t/e.LOOP_TIME)}},{key:"__handleTime",value:function(){this.loopCounter++,this.loopCounter>=10&&(this.timeHandler(),this.loopCounter=0)}}],[{key:"LOOP_TIME",get:function(){return 100}}]),e}(),XFullScreenButton=function(e){_inherits(n,_wrapNativeSuper(HTMLElement));var t=_createSuper(n);function n(){var e;_classCallCheck(this,n),(e=t.call(this)).clickHandler=null;var i=e.attachShadow({mode:"open"}),r=e.__createButton();return i.append(r),i.appendChild(e.__getStyle()),e}return _createClass(n,[{key:"__createButton",value:function(){var e=document.createElement("div");return e.classList.add("fs-button-container"),e.addEventListener("click",this.__buttonClicked.bind(this)),this.icon=document.createElement("i"),this.icon.classList.add("gg-maximize"),e.appendChild(this.icon),e}},{key:"__buttonClicked",value:function(e){this.clickHandler(e)}},{key:"isFullScreenActive",value:function(e){!0===e?(this.icon.classList.remove("gg-maximize"),this.icon.classList.add("gg-minimize")):(this.icon.classList.remove("gg-minimize"),this.icon.classList.add("gg-maximize"))}},{key:"__getStyle",value:function(){var e=document.createElement("style");return e.textContent='\n        \n            .fs-button-container {\n                background: lightgray;\n                border-radius: 5px;\n                cursor: pointer;\n                width: 35px;\n                height: 35px;\n                display:flex;\n            }\n\n            .fs-button-container:focus,\n            .fs-button-container:hover {\n                background: darkgray;\n            }\n\n            .gg-maximize {\n                box-sizing: border-box;\n                position: relative;\n                display: block;\n                transform: scale(var(--ggs,1));\n                width: 14px;\n                height: 14px;\n                box-shadow:\n                    -6px -6px 0 -4px,\n                    6px 6px 0 -4px,\n                    6px -6px 0 -4px,\n                    -6px 6px 0 -4px;\n                margin: auto;\n            }\n            \n            .gg-minimize {\n                box-sizing: border-box;\n                position: relative;\n                display: block;\n                transform: scale(var(--ggs,1));\n                width: 4px;\n                height: 4px;\n                box-shadow:\n                    -8px -4px 0 -1px,\n                    -6px -4px 0 -1px,\n                    8px 4px 0 -1px,\n                    6px 4px 0 -1px,\n                    8px -4px 0 -1px,\n                    6px -4px 0 -1px,\n                    -8px 4px 0 -1px,\n                    -6px 4px 0 -1px;\n                margin: auto;\n            }\n            .gg-minimize::after,\n            .gg-minimize::before {\n                content: "";\n                display: block;\n                box-sizing: border-box;\n                position: absolute;\n                width: 2px;\n                height: 18px;\n                border-top: 6px solid;\n                border-bottom: 6px solid;\n                box-shadow: 18px 0 0 -2px;\n                top: -7px;\n            }\n            .gg-minimize::after {\n                left: -3px;\n            }\n            .gg-minimize::before {\n                right: -3px;\n            }\n\n        ',e}}]),n}();customElements.define("x-full-screen-button",XFullScreenButton);var XPauseScreen=function(e){_inherits(n,_wrapNativeSuper(HTMLElement));var t=_createSuper(n);function n(){var e;_classCallCheck(this,n),(e=t.call(this)).htmlManager=new HTMLManager,e.didClick=null;var i=e.attachShadow({mode:"open"}),r=e.htmlManager.createElement("div",["pause-container"]);return r.addEventListener("click",e.__onClick.bind(_assertThisInitialized(e))),i.appendChild(r),i.appendChild(e.__getStyle()),e}return _createClass(n,[{key:"hide",value:function(){this.shadowRoot.querySelector(".pause-container").classList.add("hide")}},{key:"show",value:function(){this.shadowRoot.querySelector(".pause-container").classList.remove("hide")}},{key:"__onClick",value:function(){this.didClick()}},{key:"__addPlayIcon",value:function(e){var t=this.htmlManager.createElement("img",["play-image"]);t.src="./../../API/assets/play-button.svg",e.appendChild(t)}},{key:"__getStyle",value:function(){var e=document.createElement("style");return e.textContent="\n\n            .pause-container {\n                width: 100%;\n                height: 100%;\n                background: rgba(0,0,0,0.1);\n                cursor: pointer;\n                display: flex;\n                margin: 0;\n            }\n\n            .hide {\n                opacity: 0;\n            }\n\n            .play-image {\n                width: 100px;\n                height: 100px;\n                margin: auto;\n            }\n        ",e}}]),n}();customElements.define("x-pause-screen",XPauseScreen);var XProgressBar=function(e){_inherits(n,_wrapNativeSuper(HTMLElement));var t=_createSuper(n);function n(){var e;_classCallCheck(this,n),(e=t.call(this)).isMoving=!1,e.htmlManager=new HTMLManager,e.maxLength=100,e.currentLength=0,e.currentProgress=0,e.progressBarChanged=null;var i=e.attachShadow({mode:"open"});e.__setupEventsListeners();var r=e.htmlManager.createElement("div",["progress-bar"]);return i.appendChild(e.getStyle()),i.appendChild(r),e}return _createClass(n,[{key:"addMarkerAt",value:function(e){var t=this.htmlManager.createElement("div",["progress-bar-marker"]),n=this.convertLengthToProgress(e);this.shadowRoot.appendChild(t),t.style.left=n+"%"}},{key:"__setupEventsListeners",value:function(){this.onmousedown=this.__mouseDown.bind(this),document.addEventListener("mouseup",this.__mouseUp.bind(this)),document.addEventListener("mouseleave",this.__mouseLeave.bind(this)),document.addEventListener("mousemove",this.__mouseMoving.bind(this))}},{key:"__recalculatePosition",value:function(e){var t=this.getBoundingClientRect(),n=(e-t.left)/t.width;n=(n=n>1?1:n)<0?0:n,this.setCurrentLength(n*this.maxLength)}},{key:"__mouseLeave",value:function(e){this.isMoving&&(this.isMoving=!1,this.__recalculatePosition(e.clientX),this.progressBarChanged(this.currentProgress))}},{key:"__mouseUp",value:function(e){this.isMoving&&(this.isMoving=!1,this.__recalculatePosition(e.clientX),this.progressBarChanged(this.currentProgress))}},{key:"__mouseMoving",value:function(e){this.isMoving&&this.__recalculatePosition(e.clientX)}},{key:"__mouseDown",value:function(e){this.isMoving=!0,this.__recalculatePosition(e.clientX)}},{key:"convertLengthToProgress",value:function(e){return Math.round(parseFloat(e)/parseFloat(this.maxLength)*100)}},{key:"setCurrentLength",value:function(e){this.currentLength=e,this.currentLength=this.currentLength>this.maxLength?this.maxLength:this.currentLength,this.currentLength=this.currentLength<0?0:this.currentLength;var t=this.shadowRoot.querySelector(".progress-bar"),n=this.convertLengthToProgress(e);this.currentProgress=n/100,t.style.width=n+"%"}},{key:"setMaxLength",value:function(e){this.maxLength=e}},{key:"increment",value:function(e){var t=1;null==e||isNaN(e)||(t=e),this.setCurrentLength(this.currentLength+t)}},{key:"getStyle",value:function(){var e=document.createElement("style");return e.textContent="\n            .progress-bar {\n                background: rgb(97, 87, 245);\n                position: absolute;\n                height: 100%;\n                width: 0%;\n            }\n\n            .progress-bar-marker {\n                width: 7px;\n                height: 100%;\n                top: 0;\n                background: yellow;\n                position: absolute;\n            }\n        ",e}}]),n}();_defineProperty(XProgressBar,"POSITION_SET","POSITION_SET"),customElements.define("x-progress-bar",XProgressBar);var XTagButton=function(e){_inherits(n,_wrapNativeSuper(HTMLElement));var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).htmlManager=new HTMLManager,e.attachShadow({mode:"open"}),e.oldIsVisible=!1,e.hoverHandler=null,e.clickHandler=null,e.leaveHandler=null,e.tagCircleContainer=e.htmlManager.createElement("div",["tag-circle-container"]),e.anchor=e.htmlManager.createElement("a",["tag-anchor"]),e.aspectRatioDiv=e.htmlManager.createElement("div",["aspect-ratio-div"]),e.shadowRoot.appendChild(e.tagCircleContainer),e.shadowRoot.appendChild(e.anchor),e.shadowRoot.appendChild(e.aspectRatioDiv),e.shadowRoot.appendChild(e.getStyle()),e.__setupEventListeners(_assertThisInitialized(e)),e}return _createClass(n,[{key:"__setupEventListeners",value:function(e){e.addEventListener("click",this.__onClick.bind(this)),e.addEventListener("mouseenter",this.__onHover.bind(this)),e.addEventListener("mouseleave",this.__onMouseLeave.bind(this))}},{key:"__onClick",value:function(e){this.clickHandler(e)}},{key:"__onHover",value:function(e){this.__animateFocusScale(),this.hoverHandler(e)}},{key:"__onMouseLeave",value:function(e){this.__animateDefaultScale(),this.leaveHandler(e)}},{key:"__animateDefaultScale",value:function(){this.anchor.classList.add("defaultScale"),this.anchor.classList.remove("focusScale"),this.anchor.classList.remove("appear")}},{key:"__animateFocusScale",value:function(){this.anchor.classList.add("focusScale"),this.anchor.classList.remove("defaultScale"),this.anchor.classList.remove("appear")}},{key:"__animateAppear",value:function(){this.style.visibility="visible",this.anchor.classList.remove("disappear"),this.tagCircleContainer.classList.remove("effectDissapear"),this.anchor.classList.add("appear"),this.tagCircleContainer.classList.add("effectAppear")}},{key:"__animateDisppear",value:function(){var e=this,t=setInterval(function(){e.style.visibility="hidden",clearTimeout(t)},350);this.anchor.classList.remove("appear"),this.tagCircleContainer.classList.remove("effectAppear"),this.anchor.classList.add("disappear"),this.tagCircleContainer.classList.add("effectDissapear")}},{key:"getStyle",value:function(){var e=document.createElement("style");return e.textContent="\n\n            .aspect-ratio-div {\n                margin-top: 100%;\n            }\n\n            .tag-circle-container {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                border-radius: 50%;\n                opacity: 0;\n\n                -webkit-transition: opacity 0.3s;\n                -moz-transition: opacity 0.3s;\n                -ms-transition: opacity 0.3s;\n                -o-transition: opacity 0.3s;\n                transition: opacity 0.3s;\n\n                -webkit-animation: crescendo 1.5s alternate infinite ease-in;\n                -moz-animation: crescendo 1.5s alternate infinite ease-in;\n                -ms-animation: crescendo 1.5s alternate infinite ease-in;\n                -o-animation: crescendo 1.5s alternate infinite ease-in;\n                animation: crescendo 1.5s alternate infinite ease-in;\n\n            }\n\n            .tag-circle-container.effectAppear {\n                opacity: 1;\n            }\n\n            .tag-circle-container.effectDissapear {\n                opacity: 0;\n            }\n\n\n            @keyframes crescendo {\n                0% {transform: scale(1);}\n                100% {transform: scale(1.5);}\n            }\n\n            .tag-anchor {\n                display:block;\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                border-radius: 50%;\n                cursor: pointer;\n                transform: scale(0);\n                -webkit-transition: transform 0.3s;\n                -moz-transition: transform 0.3s;\n                -ms-transition: transform 0.3s;\n                -o-transition: transform 0.3s;\n                transition: transform 0.3s;\n            }\n\n            .tag-anchor.defaultScale {\n                transform: scale(1);\n            }\n\n            .tag-anchor.focusScale {\n                transform: scale(1.5);\n            }\n\n            .tag-anchor.disappear {\n                transform: scale(0);\n            }\n\n            .tag-anchor.appear {\n                transform: scale(1);\n            }\n        ",e}},{key:"hexColor",set:function(e){var t=this.shadowRoot.querySelector(".tag-anchor"),n=this.shadowRoot.querySelector(".tag-circle-container"),i=this.htmlManager.hexToRGBA(e,.5);t.style.background=e,n.style.background=i},get:function(){return this.hexColor}},{key:"position",set:function(e){this.style.top=e.x+"%",this.style.left=e.y+"%",this.style.transform="translate(-50%, -50%)"}},{key:"isVisible",set:function(e){this.oldIsVisible!==e&&(!0===e?this.__animateAppear():!1===e&&this.__animateDisppear(),this.oldIsVisible=e)}}]),n}();customElements.define("x-tag-button",XTagButton);var XTimeCounter=function(e){_inherits(n,_wrapNativeSuper(HTMLElement));var t=_createSuper(n);function n(){var e;_classCallCheck(this,n),(e=t.call(this)).attachShadow({mode:"open"}),e.htmlManager=new HTMLManager,e.currentTime=0;var i=e.htmlManager.createElement("p",["time-text-element"]);return i.textContent="00:00",e.shadowRoot.appendChild(i),e.shadowRoot.appendChild(e.__getStyle()),e}return _createClass(n,[{key:"incrementTime",value:function(){this.currentTime=this.currentTime+1}},{key:"__getStyle",value:function(){var e=document.createElement("style");return e.textContent="\n            .time-text-element {\n                color: white;\n                margin: 0;\n            }\n        ",e}},{key:"currentTime",set:function(e){var t=this.shadowRoot.querySelector(".time-text-element");if(null!=t){var n=Math.floor(e/3600).toString().padStart(2,"0"),i=Math.floor((e-3600*n)/60).toString().padStart(2,"0"),r=n<=0?"":n+":";r+=i+":"+Math.floor(e-3600*n-60*i).toString().padStart(2,"0"),t.textContent=r}}}]),n}();customElements.define("x-time-counter",XTimeCounter);var XVolumeBar=function(e){_inherits(n,_wrapNativeSuper(HTMLElement));var t=_createSuper(n);function n(){var e;_classCallCheck(this,n),(e=t.call(this)).htmlManager=new HTMLManager,e.maxVolume=100,e.volume=0,e.isVolMoving=!1,e.volumeChanged=function(){};var i=e.attachShadow({mode:"open"}),r=e.htmlManager.createElement("div",["volume-bar-container"]),a=e.createVolumeButton(),o=e.htmlManager.createElement("div",["volume-bar-rect"]),s=e.htmlManager.createElement("div",["volume-bar-level"]);return r.appendChild(a),r.appendChild(o),o.appendChild(s),i.appendChild(r),i.appendChild(e.getStyle()),e.__setupEventsListeners(o,r),e}return _createClass(n,[{key:"createVolumeButton",value:function(){var e=this.htmlManager.createElement("div",["volume-icon-container"]),t=this.htmlManager.createElement("button",["volume-button"]),n=this.htmlManager.createElement("i",["gg-volume"]);return e.appendChild(t),t.appendChild(n),e}},{key:"__setupEventsListeners",value:function(e,t){e.onmousedown=this.__mouseDown.bind(this),t.onmouseenter=this.__mouseEnter.bind(this),t.onmouseleave=this.__mouseLeaveElement.bind(this),document.addEventListener("mouseup",this.__mouseUp.bind(this)),document.addEventListener("mouseleave",this.__mouseLeaveDocument.bind(this)),document.addEventListener("mousemove",this.__mouseMoving.bind(this))}},{key:"__mouseEnter",value:function(){this.shadowRoot.querySelector(".volume-bar-rect").classList.add("volume-bar-rect-focus")}},{key:"__mouseLeaveDocument",value:function(){this.isVolMoving=!1}},{key:"__mouseLeaveElement",value:function(){this.isVolMoving||this.shadowRoot.querySelector(".volume-bar-rect").classList.remove("volume-bar-rect-focus")}},{key:"__mouseUp",value:function(){this.isVolMoving=!1}},{key:"__mouseMoving",value:function(e){this.isVolMoving&&this.__calculateVolumePosition(e.clientX)}},{key:"__mouseDown",value:function(e){this.isVolMoving=!0,this.__calculateVolumePosition(e.clientX)}},{key:"__calculateVolumePosition",value:function(e){var t=this.shadowRoot.querySelector(".volume-bar-rect").getBoundingClientRect(),n=(e-t.left)/t.width;this.setVolume(n*this.maxVolume)}},{key:"setVolume",value:function(e){e=(e=e<0?0:e)>100?100:e,this.volume=e,this.volumeChanged(e),this.shadowRoot.querySelector(".volume-bar-level").style.width=e+"%"}},{key:"getStyle",value:function(){var e=document.createElement("style");return e.textContent='\n            .volume-bar-container {\n                margin-right: 0.5px;\n                cursor: pointer;\n                display: flex;\n            }\n\n            .volume-bar-container:hover,\n            .volume-bar-container:focus {\n                color: rgb(97, 87, 245);\n            }\n            \n            .volume-bar-rect {\n                display: none;\n                height: 3px;\n                background:white;\n                width: 50px;\n                margin: auto;\n                cursor: pointer;\n                transition: height 0.2s;\n            }\n\n            .volume-bar-rect:hover,\n            .volume-bar-rect:focus {\n                height: 7px;\n            }\n            \n             .volume-bar-rect-focus {\n                display: block;\n            }\n\n            .volume-bar-level {\n                height: 100%;\n                width: 0%;\n                background: rgb(97, 87, 245);\n            }\n            \n            .volume-icon-container {\n                background: rgba(0,0,0,0);\n                height: 2em;\n                padding-left: 0.4em;\n                padding-right: 0.4em;\n                border: none;\n                cursor: pointer;\n            }\n            \n            .volume-button {\n                color: white;  \n                border: none;\n                outline: none;\n                background-color: rgba(0,0,0,0);\n                height: 100%; \n                width: 2em;\n                margin: auto;\n                padding: 0;\n                cursor: pointer;\n            }\n            \n            .volume-button:hover,\n            .volume-button:focus {\n                color: rgb(97, 87, 245);\n            }\n\n            /* ICON */\n            /* ICON */\n            .gg-volume {\n                box-sizing: border-box;\n                position: relative;\n                display: block;\n                transform: scale(var(--ggs,1));\n                width: 8px;\n                height: 8px;\n                border: 2px solid;\n                border-right: 0;\n                -webkit-perspective: 12px;\n                perspective: 12px;\n                border-top-left-radius: 4px;\n                border-bottom-left-radius: 4px;\n                margin: 0;\n            }\n            .gg-volume::after,\n            .gg-volume::before {\n                content: "";\n                display: block;\n                box-sizing: border-box;\n                position: absolute;\n            }\n            .gg-volume::before {\n                left: 2px;\n                transform: rotateY(-90deg);\n                width: 10px;\n                height: 10px;\n                border: 2px solid;\n                border-left: 0;\n                top: -3px;\n            }\n            .gg-volume::after {\n                width: 8px;\n                height: 16px;\n                border: 6px double;\n                border-left: 0;\n                border-top-right-radius: 100px;\n                border-bottom-right-radius: 100px;\n                right: -14px;\n                top: -6px;\n            }    \n        ',e}}]),n}();customElements.define("x-volume-bar",XVolumeBar);var BottomBarController=function(){function e(t,n,i){_classCallCheck(this,e),this.hypervideoController=t,this.htmlManager=new HTMLManager,this.containerID=n,this.tags=i}return _createClass(e,[{key:"addBottomBar",value:function(e){var t=this.htmlManager.createElement("div",["bottom-controller"]);e.appendChild(t),this.playButton=this.createControlButton("control-play-button","gg-play-button",this.playButtonClicked),this.replayButton=this.createControlButton("control-repeat-button","gg-repeat",this.restartVideo),this.fullScreenButton=this.createControlButton("control-full-screen-button","gg-maximize",this.toggleFullScreen),this.timeCounter=this.createTimeCounter(),this.progressBar=this.createProgressBar(),this.volumeBar=this.createVolumeBar(),t.appendChild(this.playButton),t.appendChild(this.replayButton),t.appendChild(this.fullScreenButton),t.appendChild(this.timeCounter),t.appendChild(this.progressBar),t.appendChild(this.volumeBar)}},{key:"videoStateChanged",value:function(e,t){switch(e){case ContainerManager.PLAYING:this.changeButtonIcon("control-play-button","gg-play-pause");break;case ContainerManager.PAUSED:this.changeButtonIcon("control-play-button","gg-play-button");break;case ContainerManager.LOADED:this.volumeBar.setVolume(50),this.videoLength=t.duration,this.progressBar.setMaxLength(t.duration),this.__setProgressBarTimestamps();break;case ContainerManager.ENTER_FULL_SCREEN:this.changeButtonIcon("control-full-screen-button","gg-minimize");break;case ContainerManager.EXIT_FULL_SCREEN:this.changeButtonIcon("control-full-screen-button","gg-maximize")}}},{key:"videoTimeChange",value:function(e){this.progressBar.setCurrentLength(e),this.timeCounter.currentTime=e}},{key:"restartVideo",value:function(){this.progressBar.setCurrentLength(0),this.hypervideoController.restartVideo()}},{key:"toggleFullScreen",value:function(){this.hypervideoController.toggleFullScreen()}},{key:"playButtonClicked",value:function(){this.hypervideoController.play()}},{key:"changeButtonIcon",value:function(e,t){var n=document.getElementById(this.containerID).querySelector("."+e);if(!(n.length<=0)){var i=n.getElementsByTagName("i");i.length<=0||(i[0].className=t)}}},{key:"createTimeCounter",value:function(){return this.htmlManager.createElement("x-time-counter",["time-counter"])}},{key:"createControlButton",value:function(e,t,n){var i=this.htmlManager.createElement("div",["control-button-container"]),r=this.htmlManager.createElement("button",["control-button",e]),a=this.htmlManager.createElement("i",[t]);return i.appendChild(r),r.appendChild(a),null!=n&&i.addEventListener("click",n.bind(this)),i}},{key:"createProgressBar",value:function(){var e=this.htmlManager.createElement("x-progress-bar",["progress-container"]);return e.progressBarChanged=this.__progressBarChanged.bind(this),null!==this.videoLength&&e.setMaxLength(this.videoLength),e}},{key:"__progressBarChanged",value:function(e){this.hypervideoController.loadVideoProgress(e)}},{key:"__setProgressBarTimestamps",value:function(){var e,t=_createForOfIteratorHelper(this.tags);try{for(t.s();!(e=t.n()).done;){var n=e.value.timeConfig.timestamp;this.progressBar.addMarkerAt(n)}}catch(e){t.e(e)}finally{t.f()}}},{key:"createVolumeBar",value:function(){var e=this.htmlManager.createElement("x-volume-bar",["volume-bar"]);return e.volumeChanged=this.__volumeChanged.bind(this),e}},{key:"__volumeChanged",value:function(e){this.hypervideoController.setVolume(e/100)}}]),e}(),HyperimageController=function(){function e(t,n,i){_classCallCheck(this,e),this.containerID=n,this.imageSRC=t,this.tags=i,this.htmlManager=new HTMLManager,this.tagController=new TagsController(this.containerID,this.containerID+"-elements",null),this.containerManager=new ContainerManager(this.containerID),this.containerManager.videoStateChanged=this.__videoStateChanged.bind(this)}return _createClass(e,[{key:"__videoStateChanged",value:function(e,t){switch(e){case ContainerManager.ENTER_FULL_SCREEN:this.__fullScreenStateChanged(!0);break;case ContainerManager.EXIT_FULL_SCREEN:this.__fullScreenStateChanged(!1)}}},{key:"__fullScreenStateChanged",value:function(e){null!=this.tagController&&this.tagController.fullScreenStateChanged(e),null!=this.fullScreenButton&&this.fullScreenButton.isFullScreenActive(e)}},{key:"__imgLoaded",value:function(){this.__addTags()}},{key:"createSkeleton",value:function(){var e=document.getElementById(this.containerID),t=this.htmlManager.createElement("div",["hypervideo-container"]);e.appendChild(t),this.__addImageElement(t),this.__addFullScreenButton(t),this.tagController.addTagContainer(t),this.__addElementsContainer()}},{key:"__addFullScreenButton",value:function(e){this.fullScreenButton=document.createElement("x-full-screen-button");var t=this;this.fullScreenButton.clickHandler=function(){t.containerManager.toggleFullScreen()},e.appendChild(this.fullScreenButton)}},{key:"__addImageElement",value:function(e){var t=document.createElement("img");t.classList.add("hyperimage"),t.src=this.imageSRC,e.appendChild(t),t.addEventListener("load",this.__imgLoaded.bind(this))}},{key:"__addTags",value:function(){this.tagController.addTags(this.tags,!1);var e,t=_createForOfIteratorHelper(this.tags);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.tagController.setTagVisible(n.id,!0)}}catch(e){t.e(e)}finally{t.f()}}},{key:"__addElementsContainer",value:function(){var e=document.createElement("div");e.id=this.containerID+"-elements",e.style.display="none",e.style.position="fixed",e.style.width="100%",e.style.height="100%",e.style.background="rgba(0,0,0,0.5)",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="all",e.addEventListener("click",function(t){e===t.target&&(e.style.display="none")}),document.body.appendChild(e)}}]),e}(),Hypervideo=function(){function e(t,n,i){_classCallCheck(this,e),this.videoURL=t,this.videoType=n,this.containerID=i}return _createClass(e,[{key:"isDOMLoaded",value:function(){return null!=document&&("interactive"===document.readyState||"complete"===document.readyState)}},{key:"setupHypervideo",value:function(t){if(this.__addGlobalStyle(),document.getElementById(this.containerID).appendChild(this.getStyle()),!this.isDOMLoaded())throw"Error: Can't setup an hypervideo if DOM is not loaded.";if(this.tags=this.__tagsJSONToObject(t),this.videoType===e.IMAGE_TYPE){new HyperimageController(this.videoURL,this.containerID,this.tags).createSkeleton()}else{var n=(new VideoManagerFactory).create(this.videoType,this.containerID);new HypervideoController(this.videoURL,this.videoType,this.containerID,n,this.tags).createSkeleton()}}},{key:"__tagsJSONToObject",value:function(e){var t=this;try{var n=JSON.parse(e).tags,i=0;return n=n.map(function(e){return e.id=t.containerID+"-tag-"+i++,e})}catch(e){throw"Error: Not valid JSON"}}},{key:"__addGlobalStyle",value:function(){var e=document.createElement("style");e.textContent="\n            .hypervideo:-moz-full-screen {\n                width: 100%;\n                height: 100%;\n            }\n            \n            .hypervideo:-webkit-full-screen {\n                width: 100%;\n                height: 100%;\n            }\n            \n            .hypervideo:fullscreen {\n                width: 100%;\n                height: 100%;\n            }\n        ",document.querySelector("head").appendChild(e)}},{key:"getStyle",value:function(){var e=document.createElement("style");return e.textContent='\n\n        video {\n            width: 100%;\n            height: 100%;\n            background: black;\n        }\n        \n        button {\n            cursor: pointer;\n        }\n        \n        .youtube-frame {\n            width: 100%;\n            height: 100%;\n        }\n\n        .hyperimage {\n            width: 100%;\n            height: 100%;\n            object-fit: contain;\n        }\n        \n        .hypervideo-container {\n            position: relative;\n            width: 100%;\n            height: 100%;\n            user-drag: none; \n            user-select: none;\n            -moz-user-select: none;\n            -webkit-user-drag: none;\n            -webkit-user-select: none;\n            -ms-user-select: none;\n        }\n\n        .hypervideo-container-fullscreen {\n\n        }\n        \n        /* Top control bar */\n        .top-controller {\n            background-color: rgba(0, 150, 0, 0.37);;\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n        }\n        \n\n        /* Tags */\n\n        x-tag-button {\n            pointer-events: all;\n            position: absolute;\n            width: 5%;\n            top: 50px;\n            left: 50px;\n            display: block;\n            visibility: hidden;\n        }\n\n        .tags-container {\n            pointer-events: none;\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n        }\n\n        /*  Bottom control bar  */\n        .bottom-controller {\n            display: flex;\n            opacity: 0;\n            justify-content: flex-start;\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            background: rgb(2,0,36);\n            background: linear-gradient(0deg, rgba(2,0,36,1) 30%, rgba(0,212,255,0) 100%);\n            padding: 4px;\n            transition: opacity 0.2s;\n        }\n\n        .hypervideo-container:hover > .bottom-controller,\n        .hypervideo-container:focus > .bottom-controller {\n            opacity: 1;\n        }\n        \n        .control-button-container {\n            background: rgba(0,0,0,0);\n            height: 2em;\n            padding-left: 0.4em;\n            padding-right: 0.4em;\n            border: none;\n            cursor: pointer;\n        }\n        \n        .control-button-container:not(:last-child) {\n            margin-right: 2px;\n        }\n        \n        .control-button {\n            color: white;  \n            border: none;\n            outline: none;\n            background-color: rgba(0,0,0,0);\n            height: 100%; \n            width: 2em;\n            margin: auto;\n            padding: 0;\n        }\n        \n        .control-button:hover,\n        .control-button:focus {\n            color: rgb(97, 87, 245);\n        }\n        \n        .progress-container {\n            flex-grow: 1;\n            margin-right: 2px;\n            height: 3px;\n            background: rgba(210,210,210,0.68);\n            align-self: center;\n            position: relative;\n            cursor: pointer; \n            transition: height 0.2s;\n        }        \n\n        .progress-container:focus,\n        .progress-container:hover {\n            height: 5px;\n        }\n\n        x-time-counter {\n            display: flex;\n            margin-right: 1em;\n            align-items: center;\n        }\n\n        x-pause-screen {\n            width: 100%;\n            height: 100%;\n            margin: auto;\n            position: absolute;\n            top: 0;\n            left: 0;\n        }\n\n        x-full-screen-button {\n            position: absolute;\n            bottom: 1em;\n            right: 1em;\n        }\n\n        \n        /* ICONS */\n        \n        .gg-play-button {\n            box-sizing: border-box;\n            position: relative;\n            display: block;\n            transform: scale(var(--ggs,1));\n            width: 22px;\n            height: 22px;\n            margin: auto; /*Aquesta linia s\'ha d\'afegir*/\n        }\n        .gg-play-button::before {\n            content: "";\n            display: block;\n            box-sizing: border-box;\n            position: absolute;\n            width: 0;\n            height: 10px;\n            border-top: 5px solid transparent;\n            border-bottom: 5px solid transparent;\n            border-left: 6px solid;\n            top: 6px;\n            left: 9px;\n        }\n        \n        .gg-repeat {\n            box-sizing: border-box;\n            position: relative;\n            display: block;\n            transform: scale(var(--ggs,1));\n            box-shadow:\n                -2px -2px 0 0,\n                2px 2px 0 0;\n            width: 14px;\n            height: 6px;\n            margin: auto;\n        }\n        .gg-repeat::after,\n        .gg-repeat::before {\n            content: "";\n            display: block;\n            box-sizing: border-box;\n            position: absolute;\n            width: 0;\n            height: 0;\n            border-top: 3px solid transparent;\n            border-bottom: 3px solid transparent;\n        }\n        .gg-repeat::before {\n            border-left: 5px solid;\n            top: -4px;\n            right: 0;\n        }\n        .gg-repeat::after {\n            border-right: 5px solid;\n            bottom: -4px;\n            left: 0;\n        }\n        .gg-maximize {\n            box-sizing: border-box;\n            position: relative;\n            display: block;\n            transform: scale(var(--ggs,1));\n            width: 14px;\n            height: 14px;\n            box-shadow:\n                -6px -6px 0 -4px,\n                6px 6px 0 -4px,\n                6px -6px 0 -4px,\n                -6px 6px 0 -4px;\n            margin: auto;\n        }\n        \n        .gg-minimize {\n            box-sizing: border-box;\n            position: relative;\n            display: block;\n            transform: scale(var(--ggs,1));\n            width: 4px;\n            height: 4px;\n            box-shadow:\n                -8px -4px 0 -1px,\n                -6px -4px 0 -1px,\n                8px 4px 0 -1px,\n                6px 4px 0 -1px,\n                8px -4px 0 -1px,\n                6px -4px 0 -1px,\n                -8px 4px 0 -1px,\n                -6px 4px 0 -1px;\n            margin: auto;\n        }\n        .gg-minimize::after,\n        .gg-minimize::before {\n            content: "";\n            display: block;\n            box-sizing: border-box;\n            position: absolute;\n            width: 2px;\n            height: 18px;\n            border-top: 6px solid;\n            border-bottom: 6px solid;\n            box-shadow: 18px 0 0 -2px;\n            top: -7px;\n        }\n        .gg-minimize::after {\n            left: -3px;\n        }\n        .gg-minimize::before {\n            right: -3px;\n        }\n        \n        .gg-play-pause {\n            box-sizing: border-box;\n            position: relative;\n            display: block;\n            transform: scale(var(--ggs,1));\n            width: 8px;\n            height: 10px;\n            border-left: 3px solid;\n            border-right: 3px solid;\n            margin: auto;\n        }\n        \n        ',e}}]),e}();_defineProperty(Hypervideo,"YOUTUBE_TYPE","YOUTUBE"),_defineProperty(Hypervideo,"VIDEO_TYPE","VIDEO"),_defineProperty(Hypervideo,"IMAGE_TYPE","IMAGE");var HypervideoController=function(){function e(t,n,i,r,a){_classCallCheck(this,e),this.videoLength=null,this.containerID=i,this.videoSRC=t,this.videoManager=r,this.videoType=n,this.tags=a,this.htmlManager=new HTMLManager,this.videoManager.videoStateChanged=this.__videoStateChanged.bind(this),this.bottomBarController=new BottomBarController(this,i,a),this.tagController=new TagsController(this.containerID,this.containerID+"-elements",r)}return _createClass(e,[{key:"__videoStateChanged",value:function(e,t){var n=document.getElementById(this.containerID).querySelector("x-pause-screen");switch(e){case ContainerManager.PLAYING:n.hide();break;case ContainerManager.PAUSED:n.show();break;case ContainerManager.LOADED:this.videoManager.setVolume(.5),this.videoLength=t.duration,this.__addVideoTimeObserver(),this.__addTags();break;case ContainerManager.ENTER_FULL_SCREEN:case ContainerManager.EXIT_FULL_SCREEN:null!=this.tagController&&this.tagController.fullScreenStateChanged(e===ContainerManager.ENTER_FULL_SCREEN)}this.bottomBarController.videoStateChanged(e,t)}},{key:"restartVideo",value:function(){this.videoManager.restartVideo()}},{key:"toggleFullScreen",value:function(){this.videoManager.toggleFullScreen()}},{key:"setVolume",value:function(e){this.videoManager.setVolume(e)}},{key:"loadVideoProgress",value:function(e){this.videoManager.loadProgress(e)}},{key:"play",value:function(){this.videoManager.isVideoPlaying()?this.videoManager.pause():this.videoManager.play()}},{key:"changeButtonIcon",value:function(e,t){var n=document.getElementById(this.containerID).querySelector("."+e);if(!(n.length<=0)){var i=n.getElementsByTagName("i");i.length<=0||(i[0].className=t)}}},{key:"createSkeleton",value:function(){var e=document.getElementById(this.containerID),t=this.htmlManager.createElement("div",["hypervideo-container"]);e.appendChild(t),this.addVideoElement(t),this.videoType!=Hypervideo.YOUTUBE_TYPE&&this.addTopBarControlls(t),this.__addPauseScreen(t),this.tagController.addTagContainer(t),this.bottomBarController.addBottomBar(t),this.__addElementsContainer()}},{key:"addVideoTag",value:function(e){this.videoElementID="video-"+this.containerID;var t=this.htmlManager.createElement("video","",this.videoElementID);t.src=this.videoSRC,e.appendChild(t),this.videoManager.setupVideo()}},{key:"addVideoFromYotube",value:function(e){this.videoElementID="video-"+this.containerID;var t=this.htmlManager.createElement("div",["youtube-frame"]);t.id=this.videoElementID,e.appendChild(t),this.videoManager.addYoutubeScript(this.videoElementID,this.videoSRC)}},{key:"addVideoElement",value:function(e){switch(this.videoType){case Hypervideo.YOUTUBE_TYPE:this.addVideoFromYotube(e);break;default:this.addVideoTag(e)}}},{key:"addTopBarControlls",value:function(e){var t=this.htmlManager.createElement("div",["top-controller"]);e.appendChild(t)}},{key:"__addPauseScreen",value:function(e){var t=this.htmlManager.createElement("x-pause-screen"),n=this;t.didClick=function(){n.videoManager.isVideoPlaying()?n.videoManager.pause():n.videoManager.play()},e.appendChild(t)}},{key:"__addVideoTimeObserver",value:function(){var e=this,t=new Observer(function(t){e.bottomBarController.videoTimeChange(t),e.__manageTags(t)});this.videoManager.addObserver(t)}},{key:"__addTags",value:function(){this.tagController.addTags(this.tags,!1)}},{key:"__manageTags",value:function(e){var t,n=_createForOfIteratorHelper(this.tags);try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.timeConfig.timestamp,a=i.timeConfig.duration,o=e>=r&&e<r+a;this.tagController.setTagVisible(i.id,o)}}catch(e){n.e(e)}finally{n.f()}}},{key:"__addElementsContainer",value:function(){var e=document.createElement("div");e.id=this.containerID+"-elements",e.style.display="none",e.style.position="fixed",e.style.width="100%",e.style.height="100%",e.style.background="rgba(0,0,0,0.5)",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="all",e.addEventListener("click",function(t){e===t.target&&(e.style.display="none")}),document.body.appendChild(e)}}]),e}(),TagsController=function(){function TagsController(e,t,n){_classCallCheck(this,TagsController),this.containerID=e,this.elementsContainerID=t,this.videoManager=n,this.htmlManager=new HTMLManager,this.plugins=[]}return _createClass(TagsController,[{key:"addTagContainer",value:function(e){this.tagsContainer=this.htmlManager.createElement("div",["tags-container"]),e.appendChild(this.tagsContainer)}},{key:"addTags",value:function(e,t){this.tags=e;var n,i=_createForOfIteratorHelper(this.tags);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.__addTagButton(r,t);var a=null;null!=r.plugin&&(a=r.plugin),this.__createTagPluginForTagIfNeeded(r.id,a)}}catch(e){i.e(e)}finally{i.f()}}},{key:"setTagVisible",value:function(e,t){document.querySelector("#"+this.containerID).querySelector("#"+e).isVisible=t}},{key:"fullScreenStateChanged",value:function(e){for(var t in this.plugins){this.plugins[t].fullScreenStateChanged(e)}this.__moveElementsContainer(e?this.tagsContainer:document.body)}},{key:"__moveElementsContainer",value:function(e){var t=document.getElementById(this.elementsContainerID);e.appendChild(t)}},{key:"__onClickTag",value:function(e){var t=e.target,n=this.__getTagFromElement(t);null!=n&&null!=this.plugins[n.id]&&this.plugins[n.id].onTagClick(e)}},{key:"__onHoverTag",value:function(e){var t=e.target,n=this.__getTagFromElement(t);null!=n&&null!=this.plugins[n.id]&&this.plugins[n.id].onTagHover(e)}},{key:"__onLeaveTag",value:function(e){var t=e.target,n=this.__getTagFromElement(t);null!=n&&null!=this.plugins[n.id]&&this.plugins[n.id].onTagLeave(e)}},{key:"__getTagFromElement",value:function(e){var t=this.tags.filter(function(t){return t.id===e.id});return null==t||t.length<=0?null:t[0]}},{key:"__createTagPluginForTagIfNeeded",value:function __createTagPluginForTagIfNeeded(tagID,plugin){if(!this.plugins.hasOwnProperty(tagID)||null==this.plugins[tagID])if(null!=plugin){var pluginName=plugin.name,classInstance=eval("new ".concat(pluginName,"()"));classInstance.onLoad(plugin.config,this.tagsContainer,this.elementsContainerID,this.videoManager),this.plugins[tagID]=classInstance}else this.plugins[tagID]=plugin}},{key:"__addTagButton",value:function(e,t){var n=document.createElement("x-tag-button");this.tagsContainer.appendChild(n),n.hexColor=e.color?e.color:"#FFFFFF",n.position=e.position,n.isVisible=t,n.id=e.id,n.clickHandler=this.__onClickTag.bind(this),n.hoverHandler=this.__onHoverTag.bind(this),n.leaveHandler=this.__onLeaveTag.bind(this)}}]),TagsController}();